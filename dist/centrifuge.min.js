(function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}})("undefined"!=typeof self?self:this,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"Centrifuge",function(){return a});var r,s=n(1),i=n(2),o=(n.n(i),n(3)),c=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=function(e){function t(t){var n=e.call(this)||this;return n._config={},n._status="disconnected",n._isSockJS=!1,n._transport=null,n._transportName=null,n._transportClosed=!0,n._reconnect=!0,n._reconnecting=!1,n._numRefreshFailed=0,n._refreshTimeout=null,n._pongTimeout=null,n._pingInterval=null,n._messageId=0,n._messages=[],n._isBatching=!1,n._isAuthBatching=!1,n._authChannels={},n._clientID=null,n._callbacks={},n._subs={},n._retries=0,n._latency=null,n._latencyStart=null,n._lastMessageID={},n._configure(t),n}return c(t,e),t.prototype.connect=function(){this.isConnected()?this._debug("Connect called when already connected"):"connecting"!==this._status&&(this._debug("Start connecting"),this._clientID=null,this._reconnect=!0,this._setStatus("connecting"),this._setTransport())},t.prototype.disconnect=function(){this._disconnect("client")},t.prototype.isConnected=function(){return"connected"===this._status},t.prototype.isDisconnected=function(){return"disconnected"===this._status},t.prototype.ping=function(){this.addMessage({method:"ping"}).then(function(e){},function(e){})},t.prototype.startBatching=function(){this._isBatching=!0},t.prototype.stopBatching=function(e){void 0===e&&(e=!1),this._isBatching=!1,!0===e&&this.flush()},t.prototype.flush=function(){var e=this._messages.slice(0);this._messages=[],this._send(e)},t.prototype.startAuthBatching=function(){this._isAuthBatching=!0},t.prototype.stopAuthBatching=function(){var e,t,n=this;this._isAuthBatching=!1;var r=this._authChannels;this._authChannels={};var i=[];for(t in r)if(r.hasOwnProperty(t)){if(!this._getSub(t))continue;i.push(t)}if(0!==i.length){var o=function(r,s){if(!0!==r){var o=!1;for(e in n._isBatching||(n.startBatching(),o=!0),i)if(i.hasOwnProperty(e)){var c=s[t=i[e]];if(!c){n._subscribeError({error:"channel not found in authorization response",advice:"fix",body:{channel:t}});continue}if(c.status&&200!==c.status)n._subscribeError({error:c.status,body:{channel:t}});else{var a={method:"subscribe",params:{channel:t,client:n.getClientId(),info:c.info,sign:c.sign}};!0===n._recover(t)&&(a.params.recover=!0,a.params.last=n._getLastID(t)),n.addMessage(a).then(function(e){n._subscribeResponse(e)},function(e){})}}o&&n.stopBatching(!0)}else for(e in n._debug("Authorization request failed"),i)i.hasOwnProperty(e)&&(t=i[e],n._subscribeError({error:"authorization request failed",advice:"fix",body:{channel:t}}))},c={client:this.getClientId(),channels:i};if(Object(s.c)(this._config.onPrivateChannelAuth))this._config.onPrivateChannelAuth({data:c},o);else{var a=this._config.authTransport.toLowerCase();if("ajax"===a)this._ajax(this._config.authEndpoint,this._config.authParams,this._config.authHeaders,c,o);else{if("jsonp"!==a)throw new Error("Unknown private channel auth transport "+a);this._jsonp(this._config.authEndpoint,this._config.authParams,this._config.authHeaders,c,o)}}}},t.prototype.subscribe=function(e,t){if(!Object(s.d)(e))throw new Error("Illegal argument type: channel must be a string");if(!this._config.resubscribe&&!this.isConnected())throw new Error("Can not only subscribe in connected state when resubscribe option is off");var n=this._getSub(e);if(null!==n)return n.setEvents(t),n.isUnsubscribed()&&n.subscribe(),n;var r=new o.a(this,e,t);return this._subs[e]=r,r.subscribe(),r},t.prototype.subscribeSub=function(e){var t=this,n=e.channel;if(n in this._subs||(this._subs[n]=e),this.isConnected())if(e.setSubscribing(),Object(s.g)(n,this._config.privateChannelPrefix))this._isAuthBatching?this._authChannels[n]=!0:(this.startAuthBatching(),this.subscribeSub(e),this.stopAuthBatching());else{var r={method:"subscribe",params:{channel:n}};!0===this._recover(n)&&(r.params.recover=!0,r.params.last=this._getLastID(n)),this.addMessage(r).then(function(e){t._subscribeResponse(e)},function(e){t._subscribeError(e)})}else e.setNew()},t.prototype.unsubscribeSub=function(e){var t=this;this.isConnected()&&this.addMessage({method:"unsubscribe",params:{channel:e.channel}}).then(function(e){t._unsubscribeResponse(e)},function(e){})},t.prototype.getClientId=function(){return this._clientID},t.prototype.registerCall=function(e,n,r){var i=this;this._callbacks[e]={callback:n,errback:r},setTimeout(function(){delete i._callbacks[e],Object(s.c)(r)&&r(t.createErrorObject("timeout","retry"))},this._config.timeout)},t.prototype.addMessage=function(e){var t=this;return new Promise(function(n,r){var s=t._getNextMessageId()+"";e.uid=s,!0===t._isBatching?t._messages.push(e):t._send([e]),t.registerCall(s,n,r)})},t.createErrorObject=function(e,t){var n={error:e};return t&&(n.advice=t),n},t.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Object(s.e)("info",e)},t.prototype._debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];!0===this._config.debug&&Object(s.e)("debug",e)},t.prototype._jsonp=function(e,n,r,i,o){Object.keys(r).length>0&&t.log("Only AJAX request allows to send custom headers, it is not possible with JSONP."),this._debug("Sending JSONP request to",e);var c="centrifuge_jsonp_"+t.nextJSONPCallbackID.toString();t.nextJSONPCallbackID++;var a=document.createElement("script"),u=setTimeout(function(){t.jsonpCallbacks[c]=function(){},o(!0,"timeout")},3e3);t.jsonpCallbacks[c]=function(e){clearTimeout(u),o(!1,e),delete t.jsonpCallbacks[c]};var h="Centrifuge._jsonpCallbacks['"+c+"']";a.src=this._config.authEndpoint+"?callback="+encodeURIComponent(h)+"&data="+encodeURIComponent(JSON.stringify(i))+"&"+Object(s.f)(n);var f=document.getElementsByTagName("head")[0]||document.documentElement;f.insertBefore(a,f.firstChild)},t.prototype._ajax=function(e,n,r,i,o){this._debug("Sending AJAX request to",e);var c=XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),a=Object(s.f)(n);for(var u in a.length>0&&(a="?"+a),c.open("POST",e+a,!0),"withCredentials"in c&&(c.withCredentials=!0),c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.setRequestHeader("Content-Type","application/json"),r)r.hasOwnProperty(u)&&c.setRequestHeader(u,r[u]);return c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status){var e=void 0,n=!1;try{e=JSON.parse(c.responseText),n=!0}catch(e){o(!0,"JSON returned was invalid, yet status code was 200. Data was: "+c.responseText)}n&&o(!1,e)}else t.log("Could not get auth info from application",c.status),o(!0,c.status)},setTimeout(function(){c.send(JSON.stringify(i))},20),c},t.prototype._configure=function(e){if(this._debug("Configuring Centrifuge with",e),!(e=Object.assign({retry:1e3,maxRetry:2e4,timeout:5e3,info:"",resubscribe:!0,ping:!0,pingInterval:3e4,pongWaitTimeout:5e3,debug:!1,insecure:!1,privateChannelPrefix:"$",refreshEndpoint:"/centrifuge/refresh/",refreshHeaders:{},refreshParams:{},refreshData:{},refreshTransport:"ajax",refreshAttempts:0,refreshInterval:3e3,authEndpoint:"/centrifuge/auth/",authHeaders:{},authParams:{},authTransport:"ajax"},e)).url)throw new Error("Missing required configuration parameter 'url' specifying server URL");if(e.url=Object(s.h)(e.url),e.user)Object(s.d)(e.user)||t.log("Configuration parameter 'user' expected to be string");else{if(!e.insecure)throw new Error("Missing required configuration parameter 'user' specifying user's unique ID in your application");this._debug("Configuration parameter 'user' not found but this is OK for insecure mode - anonymous access will be used")}if(e.timestamp)Object(s.d)(e.timestamp)||t.log("Configuration parameter 'timestamp' expected to be string");else{if(!e.insecure)throw new Error("Missing required configuration parameter 'timestamp'");this._debug("Configuration parameter 'timestamp' not found but this is OK for insecure mode")}if(e.token)Object(s.d)(e.token)||t.log("Configuration parameter 'token' expected to be string");else{if(!e.insecure)throw new Error("Missing required configuration parameter 'token' specifying the sign of authorization request");this._debug("Configuration parameter 'token' not found but this is OK for insecure mode")}e.info&&!Object(s.d)(e.info)&&t.log("Configuration parameter 'info' expected to be string"),this._config=e},t.prototype._getSockjsEndpoint=function(){var e=this._config.url;return e=e.replace("ws://","http://").replace("wss://","https://"),e=Object(s.h)(e),Object(s.a)(this._config.url,"connection")||(e+="/connection"),e},t.prototype._getWebsocketEndpoint=function(){var e=this._config.url;return e=e.replace("http://","ws://").replace("https://","wss://"),e=Object(s.h)(e),Object(s.a)(this._config.url,"connection/websocket")||(e+="/connection/websocket"),e},t.prototype._recover=function(e){return e in this._lastMessageID},t.prototype._getLastID=function(e){var t=this._lastMessageID[e];return t?(this._debug("Last uid found and sent for channel",e),t):(this._debug("No last uid found for channel",e),"")},t.prototype._getSub=function(e){return this._subs[e]||null},t.prototype._clearConnectedState=function(e){for(var n in this._clientID=null,this._callbacks)if(this._callbacks.hasOwnProperty(n)){var r=this._callbacks[n].errback;if(!r)continue;r(t.createErrorObject("disconnected","retry"))}for(var s in this._callbacks={},this._subs)if(this._subs.hasOwnProperty(s)){var i=this._getSub(s);e?(i.isSuccess()&&i.triggerUnsubscribe(),i.setSubscribing()):i.setUnsubscribed()}this._config.resubscribe&&this._reconnect||(this._subs={})},t.prototype._setStatus=function(e){this._status!==e&&(this._debug("Status:",this._status,"->",e),this._status=e)},t.prototype._disconnect=function(e,t){void 0===t&&(t=!1),this.isDisconnected()||(this._debug("Disconnected:",e+".","shouldReconnect:",t),!1===t&&(this._reconnect=!1),this._clearConnectedState(t),this.isDisconnected()||(this._setStatus("disconnected"),this._refreshTimeout&&clearTimeout(this._refreshTimeout),!1===this._reconnecting&&this.trigger("disconnect",[{reason:e,reconnect:t}])),this._transportClosed||this._transport.close())},t.prototype._send=function(e){if(e.length){var t=1===e.length?e[0]:e;this._transport.send(JSON.stringify(t)),this._debug("Send",t)}},t.prototype._getNextMessageId=function(){return++this._messageId},t.prototype._stopPing=function(){null!==this._pongTimeout&&clearTimeout(this._pongTimeout),null!==this._pingInterval&&clearInterval(this._pingInterval)},t.prototype._startPing=function(){var e=this;!0!==this._config.ping||this._config.pingInterval<=0||!this.isConnected()||(this._pingInterval=setInterval(function(){e.isConnected()?(e.ping(),e._pongTimeout=setTimeout(function(){this._disconnect("no ping",!0)},e._config.pongWaitTimeout)):e._stopPing()},this._config.pingInterval))},t.prototype._restartPing=function(){this._stopPing(),this._startPing()},t.prototype._resetRetry=function(){this._debug("Reset retries count to 0"),this._retries=0},t.prototype._getRetryInterval=function(){this._retries+=1;var e=.5*Math.random(),t=this._config.retry*Math.pow(2,this._retries+1);return t>this._config.maxRetry&&(t=this._config.maxRetry),Math.floor((1-e)*t)},t.prototype._refreshFailed=function(){this._numRefreshFailed=0,this.isDisconnected()||this._disconnect("refresh failed"),this._config.refreshFailed&&this._config.refreshFailed()},t.prototype._refresh=function(){var e=this;if(this._debug("Refresh credentials"),0===this._config.refreshAttempts)return this._debug("Refresh attempts set to 0, do not send refresh request at all"),void this._refreshFailed();null!==this._refreshTimeout&&clearTimeout(this._refreshTimeout);var t=function(t,n){if(!0===t)return e._debug("Error getting connection credentials from refresh endpoint",n),e._numRefreshFailed++,e._refreshTimeout&&clearTimeout(e._refreshTimeout),null!==e._config.refreshAttempts&&e._numRefreshFailed>=e._config.refreshAttempts?void e._refreshFailed():void(e._refreshTimeout=setTimeout(function(){e._refresh()},e._config.refreshInterval+Math.round(1e3*Math.random())));e._numRefreshFailed=0,e._config.user=n.user,e._config.timestamp=n.timestamp,e._config.token=n.token,"info"in n?e._config.info=n.info:n.info="",e.isDisconnected()?(e._debug("Credentials refreshed, connect from scratch"),e.connect()):(e._debug("Send refreshed credentials"),e.addMessage({method:"refresh",params:n}).then(function(t){e._refreshResponse(t)},function(e){}))};if(null!==this._config.onRefresh)this._config.onRefresh({},t);else{var n=this._config.refreshTransport.toLowerCase();if("ajax"===n)this._ajax(this._config.refreshEndpoint,this._config.refreshParams,this._config.refreshHeaders,this._config.refreshData,t);else{if("jsonp"!==n)throw new Error("Unknown refresh transport "+n);this._jsonp(this._config.refreshEndpoint,this._config.refreshParams,this._config.refreshHeaders,this._config.refreshData,t)}}},t.prototype._connectResponse=function(e){var t=this;if(!this.isConnected()){if(null!==this._latencyStart&&(this._latency=(new Date).getTime()-this._latencyStart.getTime(),this._latencyStart=null),e.expires&&e.expired)return this._reconnecting=!0,this._disconnect("expired",!0),void this._refresh();if(this._clientID=e.client,this._setStatus("connected"),this._refreshTimeout&&clearTimeout(this._refreshTimeout),e.expires&&(this._refreshTimeout=setTimeout(function(){t._refresh()},1e3*e.ttl)),this._config.resubscribe){for(var n in this.startBatching(),this.startAuthBatching(),this._subs)if(this._subs.hasOwnProperty(n)){var r=this._getSub(n);r.shouldResubscribe()&&this.subscribeSub(r)}this.stopAuthBatching(),this.stopBatching(!0)}this._restartPing(),this.trigger("connect",[{version:e.version,client:e.client,transport:this._transportName,latency:this._latency}])}},t.prototype._subscribeResponse=function(e){var t=e.channel,n=this._getSub(t);if(n&&n.isSubscribing()){var r=e.messages;if(r&&r.length>0)for(var s in r=r.reverse())r.hasOwnProperty(s)&&this._messageResponse({body:r[s]});else"last"in e&&(this._lastMessageID[t]=e.last);var i=!1;"recovered"in e&&(i=e.recovered),n.setSubscribeSuccess(i)}},t.prototype._subscribeError=function(e){var t=e.channel,n=this._getSub(t);n&&n.isSubscribing()&&(this.trigger("error",[{error:e}]),n.setSubscribeError(e))},t.prototype._unsubscribeResponse=function(e){var t=this._getSub(e.channel);t&&t.setUnsubscribed()},t.prototype._joinResponse=function(e){var t=this._getSub(e.channel);t&&t.trigger("join",[e])},t.prototype._leaveResponse=function(e){var t=this._getSub(e.channel);t&&t.trigger("leave",[e])},t.prototype._refreshResponse=function(e){var t=this;if(this._refreshTimeout&&clearTimeout(this._refreshTimeout),e.expires){if(e.expired)return void(this._refreshTimeout=setTimeout(function(){t._refresh()},this._config.refreshInterval+Math.round(1e3*Math.random())));this._clientID=e.client,this._refreshTimeout=setTimeout(function(){t._refresh()},1e3*e.ttl)}},t.prototype._messageResponse=function(e){var t=e.body,n=t.channel;this._lastMessageID[n]=t.uid;var r=this._getSub(n);r&&r.trigger("message",[t])},t.prototype._handleResponse=function(e){var n=e.uid;if(n in this._callbacks){var r=this._callbacks[n];if(delete this._callbacks[n],Object(s.b)(e)){var i=r.errback;if(!i)return;i(t.createErrorObject(e.error,e.advice)),this.trigger("error",[{message:e}])}else{var o=r.callback;if(!o)return;o(e.body)}}},t.prototype._dispatchMessage=function(e){if(void 0!==e&&null!==e)switch(e.method){case"join":this._joinResponse(e);break;case"leave":this._leaveResponse(e);break;case"message":this._messageResponse(e);break;default:this._handleResponse(e)}else this._debug("Dispatch: got undefined or null message")},t.prototype._receive=function(e){if(Object.prototype.toString.call(e)===Object.prototype.toString.call([]))for(var t in e)e.hasOwnProperty(t)&&this._dispatchMessage(e[t]);else Object.prototype.toString.call(e)===Object.prototype.toString.call({})&&this._dispatchMessage(e)},t.prototype._setTransport=function(){var e=this;if(Object(s.c)(this._config.sockJS)){var t={transports:this._config.transports||["websocket","xdr-streaming","xhr-streaming","eventsource","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"]};this._config.server&&(t.server=this._config.server),this._transport=new this._config.sockJS(this._getSockjsEndpoint(),null,t),this._isSockJS=!0}else{if(!Object(s.c)(WebSocket))throw new Error("No Websocket support and no SockJS configured, can not connect");this._transport=new WebSocket(this._getWebsocketEndpoint())}this._transport.onopen=function(){e._transportClosed=!1,e._reconnecting=!1,e._isSockJS?(e._transportName=e._transport.transport,e._transport.onheartbeat=function(){e._restartPing()}):e._transportName="raw-websocket",e._resetRetry();var t={method:"connect",params:{user:e._config.user,info:e._config.info}};e._config.insecure||(t.params.timestamp=e._config.timestamp,t.params.token=e._config.token),e._latencyStart=new Date,e.addMessage(t).then(function(t){e._connectResponse(t)},function(e){})},this._transport.onerror=function(t){e._debug("Transport level error",t)},this._transport.onclose=function(t){e._transportClosed=!0;var n="Connection closed",r=!0;if(t&&"reason"in t&&t.reason)try{var s=JSON.parse(t.reason);e._debug(n+". Reason is an advice object:",s),n=s.reason,r=s.reconnect}catch(s){n=t.reason,e._debug(n+". Reason is a plain string:",n),r="disconnect"!==n}if(e._config.onTransportClose&&e._config.onTransportClose({event:t,reason:n,reconnect:r}),e._disconnect(n,r),!0===e._reconnect){e._reconnecting=!0;var i=e._getRetryInterval();e._debug("Reconnect after "+i+" milliseconds"),setTimeout(function(){!0===e._reconnect&&e.connect()},i)}},this._transport.onmessage=function(t){var n=JSON.parse(t.data);e._debug("Received",n),e._receive(n),e._restartPing()}},t.jsonpCallbacks={},t.nextJSONPCallbackID=1,t}(i.Observable)},function(e,t,n){"use strict";n.d(t,"c",function(){return r}),n.d(t,"d",function(){return s}),n.d(t,"e",function(){return i}),n.d(t,"h",function(){return o}),n.d(t,"g",function(){return c}),n.d(t,"a",function(){return a}),n.d(t,"b",function(){return u}),n.d(t,"f",function(){return h});var r=function(e){return"function"==typeof e},s=function(e){return"string"==typeof e},i=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(console){1===t.length&&(t=t[0]);var s=console[e];r(s)&&s.apply(s,t)}},o=function(e){return e.replace(/\/$/,"")},c=function(e,t){return 0===e.lastIndexOf(t,0)},a=function(e,t){return-1!==e.indexOf(t,e.length-t.length)},u=function(e){return"error"in e&&null!==e.error&&""!==e.error},h=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+(e[n]?"="+encodeURIComponent(e[n]):""));return t.join("&")}},function(e,t,n){var r;"undefined"!=typeof self&&self,r=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"Observable",function(){return r});var r=function(){function e(){this.__callbacks={}}return e.prototype.on=function(e,t){var n=this;return e.replace(/[^\s]+/g,function(e){return(n.__callbacks[e]=n.__callbacks[e]||[]).push(t),""}),this},e.prototype.one=function(e,t){return t.one=!0,this.on(e,t)},e.prototype.off=function(e,t){var n=this;if("*"===e)this.__callbacks={};else if(t)for(var r=this.__callbacks[e],s=0,i=void 0;i=r&&r[s];++s)i===t&&r.splice(s,1);else e.replace(/[^\s]+/g,function(e){return n.__callbacks[e]=[],""});return this},e.prototype.trigger=function(e,t){for(var n=this.__callbacks[e]||[],r=0,s=void 0;s=n[r];++r)s.busy||(s.busy=!0,s.apply(this,t),s.one&&(n.splice(r,1),r--),s.busy=!1);return this},e}()}])},e.exports=r()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r,s=n(1),i=n(2),o=(n.n(i),n(0)),c=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=function(e){function t(n,r,s){var i=e.call(this)||this;return i.channel=null,i._status=t.STATE_NEW,i._error=null,i._centrifuge=null,i._isResubscribe=!1,i._recovered=!1,i._ready=!1,i._promise=null,i._noResubscribe=!1,i._centrifuge=n,i.channel=r,i.setEvents(s),i._initializePromise(),i}return c(t,e),t.prototype.setEvents=function(e){if(e)if(Object(s.c)(e))this.on("message",e);else if(Object.prototype.toString.call(e)===Object.prototype.toString.call({}))for(var t=["message","join","leave","unsubscribe","subscribe","error"],n=0,r=t.length;n<r;n++){var i=t[n];i in e&&this.on(i,e[i])}},t.prototype.setNew=function(){this._status=t.STATE_NEW},t.prototype.setSubscribing=function(){!0===this._ready&&(this._initializePromise(),this._isResubscribe=!0),this._status=t.STATE_SUBSCRIBING},t.prototype.setUnsubscribed=function(e){this._status!==t.STATE_UNSUBSCRIBED&&(this._status=t.STATE_UNSUBSCRIBED,!0===e&&(this._noResubscribe=!0),this.triggerUnsubscribe())},t.prototype.setSubscribeSuccess=function(e){if(this._status!==t.STATE_SUCCESS){this._recovered=e,this._status=t.STATE_SUCCESS;var n=this._getSubscribeSuccess();this.trigger("subscribe",[n]),this._resolve(n)}},t.prototype.setSubscribeError=function(e){if(this._status!==t.STATE_ERROR){this._status=t.STATE_ERROR,this._error=e;var n=this._getSubscribeError();this.trigger("error",[n]),this._reject(n)}},t.prototype.triggerUnsubscribe=function(){this.trigger("unsubscribe",[{channel:this.channel}])},t.prototype.isUnsubscribed=function(){return this._status===t.STATE_UNSUBSCRIBED},t.prototype.isSuccess=function(){return this._status===t.STATE_SUCCESS},t.prototype.isSubscribing=function(){return this._status===t.STATE_SUBSCRIBING},t.prototype.shouldResubscribe=function(){return!this._noResubscribe},t.prototype.ready=function(e,t){this._ready&&(this.isSuccess()?e(this._getSubscribeSuccess()):t(this._getSubscribeError()))},t.prototype.subscribe=function(){if(this._status!==t.STATE_SUCCESS)return this._centrifuge.subscribeSub(this),this},t.prototype.unsubscribe=function(){this.setUnsubscribed(!0),this._centrifuge.unsubscribeSub(this)},t.prototype.publish=function(e){return this._request("publish",e)},t.prototype.presence=function(){return this._request("presence")},t.prototype.history=function(){return this._request("history")},t.prototype._initializePromise=function(){var e=this;this._ready=!1,this._promise=new Promise(function(t,n){e._resolve=function(n){e._ready=!0,t(n)},e._reject=function(t){e._ready=!0,n(t)}})},t.prototype._getSubscribeSuccess=function(){return{channel:this.channel,isResubscribe:this._isResubscribe,recovered:this._recovered}},t.prototype._getSubscribeError=function(){var e=this._error;return e.channel=this.channel,e.isResubscribe=this._isResubscribe,e},t.prototype._request=function(e,t){var n=this;return new Promise(function(r,s){n.isUnsubscribed()?s(o.Centrifuge.createErrorObject("subscription unsubscribed","fix")):n._promise.then(function(){if(n._centrifuge.isConnected()){var i={channel:n.channel};t&&(i.data=t),n._centrifuge.addMessage({method:e,params:i}).then(function(e){r(e)},function(e){s(e)})}else s(o.Centrifuge.createErrorObject("disconnected","retry"))},function(e){s(e)})})},t.STATE_NEW=0,t.STATE_SUBSCRIBING=1,t.STATE_SUCCESS=2,t.STATE_ERROR=3,t.STATE_UNSUBSCRIBED=4,t}(i.Observable)}])});